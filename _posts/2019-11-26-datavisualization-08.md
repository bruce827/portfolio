---
layout: post
comments: true
title: "08.美化你的图表-箱线图"
date: 2019-11-26 02:33:35
image: '/assets/img/dataAnalyze/'
description: 从这章开始，需要有一些统计学基础了
main-class: svg
color:
tags:
- 数据可视化
- 箱线图
- 统计学
categories:
- 数据可视化
twitter_text:
introduction: 开始有难度了啊
---

## 使用场景
同样是作为为表现离散数据的展现形式，我更倾向于使用箱线图来表示某一维度的组成。但是由于其专业性也比较强，可能会给人一种“过于专业”的印象。所以在这里我们先来说一下图表元素组成。  
![元素说明]({{"08/type.jpg" | prepend: page.image | prepend: site.baseurl}})
> 为什么不展示平均数而是中位数？
平均数大多用来表示一个群体的趋势，多用于时间尺度下的单一维度的变化，并不能很好的描述某一时间截面下的真实情况，比如某个地区当年的收入情况，如果是展现平均数的话，一个亿万富翁对数的影响是非常大的，这时候中位数就更能体现整体的收入水平。    
总结一下：
* 箱线图是针对连续型变量的，解读时候重点关注平均水平、波动程度和异常值。
* 当箱子被压得很扁，或者有很多异常的时候，试着做对数变换。
* 当只有一个连续型变量时，用户可能更希望看到变化趋势，并不适合画箱线图，直方图是更常见的选择。
* 箱线图最有效的使用途径是作比较，配合一个或者多个定性数据，画分组箱线图。
## 一个成功的案例
下图是几个关键因素对于北京二手房价的对比：
![二手房]({{"08/house.png" | prepend: page.image | prepend: site.baseurl}})
从上图我们可以清晰的分析出：*学区最重要，哪怕出行不方便，也要学区*。如果在一张图中能说明这一件事儿，那么就是一张成功的图。

## 什么样的图不适合箱线图
1. 样本数据中存在特别大或者特别小的异常值，这种立群的表现会导致箱子整体被压缩反而凸显出来这些异常值。
2. 样本数据特别少，数据一少就有有可能体现不出数据的分布，这时候还不如一张表格来的实惠。
> 其实箱线图与调研息息相关，我们更加在意的是数据整体的*集中趋势*，而非个体。  
那么如果数据就是如此呢？比如我们要做一个统计分析的web页面，在建设之初只有少量或干脆只有测试数据可用，这样我们在验收的时候就会处于被动，因为客户可不管什么*数据科学*，看着不好看就会让你改。那么现在问题就来了，能改吗？还真能改！这里提供两种解决方案：
1. 如果数据为正数（大多箱线图都表示频数），那么可以对数据做*对数变换*，然后告诉客户我们调优前后的变化。
![对数变换]({{"08/log.jpeg" | prepend: page.image | prepend: site.baseurl}})
2. 从原型上就不要使用箱线图，因为我们做web的时候很有可能是拿不到或是没有真实数据的，好多的展现形式都是“逼着”产品经理硬着头皮想出来的。所以有些时候是产品经理觉得数据本该如此，但事实上可能要用数据来驱动展现形式甚至整个数据分析模型的迭代。

## 数据都是对比出来的
没有对比就没有伤害，所以，配合着定性变量画分组箱线图，才会起到“一图胜千言”的效果。下图是一张各类业务的办理时长的箱线图：
![单据]({{"08/danju.jpg" | prepend: page.image | prepend: site.baseurl}})
从图中可以得出如下信息：
* 可以从箱子的高度看出：“实地面签见证”的波动较小，说明业务较为成熟。优化空间较小。
* 从四个中位数可以看出，“实地面签见证”最为耗时。
* “抵押”和“解压”业务较为相似，但比较而言，“抵押”业务办理会更为顺利。
* “视频面签见证”业务可以节省办理时长，但数据波动较大，相比而言最不可控。  

结论：抵押、解压业务优化空间较小；视频面签见证作为实地面签见证的补充方案的确可以优化管理，但需要在制度和流程上进行明确和优化，待数据波动趋于稳定后可完全替代实地面签业务。  
下面我们来看一个R语言的官方例子：
![牙齿]({{"08/tooth.jpeg" | prepend: page.image | prepend: site.baseurl}})
这个例子比较复杂，共涉及3个变量。定量变量是牙齿生长长度，体现在图形的纵坐标，也就是箱子展示的内容。第一个定性变量是维他命C的剂量，三个水平（0.5mg，1mg和2mg），体现在横坐标，所以一共有3组箱线图；第二个定性变量是食用的食物，是维C还是橙汁，分别用黄色和橙色展现，所以每组箱线图里又包含两个箱子。  
结论如下：
* 随着使用剂量的增加，不管食用的是哪种食物，牙齿生长长度的平均水平（中位数）都在增加。
* 当使用剂量为0.5mg和1mg时，食用橙汁带来的牙齿生长的平均长度（中位数）要比食用维C高，波动程度也相应更大。
* 当使用剂量为2mg时，食用两种食物带来的牙齿生长平均水平（中位数）相当，食用维C的牙齿生长长度波动相对更大。  
## 画好一张箱线图必备的要素
* 箱线图是针对连续型变量的，解读时候重点关注平均水平、波动程度和异常值。
* 当箱子被压得很扁，或者有很多异常的时候，试着做对数变换。
* 当只有一个连续型变量时，并不适合画箱线图，直方图是更常见的选择。
* 箱线图最有效的使用途径是作比较，配合一个或者多个定性数据，画分组箱线图。



