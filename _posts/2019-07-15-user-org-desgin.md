---
layout: post
comments: true
title: "用户角色权限模型设计"
date: 2019-07-15 09:00:54
image: '/assets/img/'
description: 每个管理系统都绕不开的问题
main-class: PM
color:
tags:
- 交互设计
- 用户权限模型
categories:
twitter_text:
introduction: 完整的用户权限模型
---

## 为什么不分成两个系统
在一个产品中，如果角色的使用场景完全不重叠且流程对立时，我们通常会设计两套系统，比如用户端和管理端。
但在B端产品中，常常出现各个角色使用场景只有部分通用，部分是隔离的，这时候就需要引入权限管理了。
![用户权限管理]({{"/PM/user-org.png" | prepend: page.image | prepend: site.url }})
设计师有时会对角色权限系统有一丝畏难情绪。一方面因为角色权限系统的配置作为一个非常后台的管理功能，在竞品调研过程中很难通过上帝视角去解剖其中逻辑，自己琢磨又较难透彻；另一方面对于角色权限系统，做好了并不能代表设计能力有多优秀，但一旦没做好就会导致整个流程不通、产品崩溃。所以设计师常对权限系统望而却步。

## RBAC模型
如果没有角色，管理员将会给每一个用户手动分配权限，这是一个繁重且易出错的工作，而角色相当于用户的权限合集，可以很好的角色这个问题。故用户与角色的关系可以分为多对一和多对多两种。
![用户权限管理]({{"/PM/n-vs-n.png" | prepend: page.image | prepend: site.url }})
### 加入用户组与权限组
在实际设计过程中，我们极力避免将用户和角色设计成多对多的情况，但是随着系统的不断的扩张，无论是管理者还是设计者都没有办法考虑到所有的场景，而互联网产品的特点就是用户复杂，我们将每一个用户划分角色仍然是巨大的工作量，这时候就需要引入**用户组**的概念了。
> 如果部分用户的使用场景是相对一致和基础的，我们可以把这些用户打包成一个组，基于这个组的对象进行角色和权限的赋予。  

如果是B端的系统我们大概率会面对用户可控但是权限繁多的情况（如销售管理系统），这时候可以再加入**权限组**来解决问题。  
这里需要说明的是，无论是用户组还是权限组都是基于有一定的用户预估以及场景规划的，如果前期需求没有搞清除，在设计时候很可能出现要么设计的功能过于灵活，产生了许多过渡设计；要么无法指导开发这两种情况。
这两种状态的最普遍应用场景就是我们的操作系统。
### 使用角色继承
如果角色需要区分课题负责人、课题管理员、制表员、课题成员等角色，并且管理方式是向下兼容时，我们采用角色的继承来划分权限，上层角色继承下层角色的全部权限，且可以额外赋予权限。
![角色的继承]({{"/PM/role-inherit.png" | prepend: page.image | prepend: site.url }})
但是光有角色的继承是不够的，为了可以实现继承，我们还有管理角色的关系，这里主要有三种方案：
![角色的继承]({{"/PM/role-relationship.png" | prepend: page.image | prepend: site.url }})
继承关系一般都来自于公司的组织架构，但是基于组织管理的系统，情况会更复杂一些，组织的管理者（用户）很可能需要自己来绘制组织架构图，来实现继承。
### 添加限制
#### 一、角色限制
如果是销售系统，我们可能会遇到部分角色时需要隔离的，也就是说有些角色是不可以同时分配给同一个人的。一个最简的场景是我既可以是提交人又可以是审批人，即”自己审批自己“。
#### 二、数量限制
比如每个课题中只能有一个负责人。

#### 三、特殊限制
在实际场景中，多种角色可能对统一功能的使用方式或数据产生冲突，比如运维角色和课题管理员角色，这时候可能会需要用户**手动选择登录用户的角色**，且系统要控制同一时间只允许用户使用一个身份进行登录。
![角色的选择]({{"/PM/user-role-choose.png" | prepend: page.image | prepend: site.url }})
这样，就可以通过前后台共同限制用户的角色和权限了。

## 权限的定义

保证初期设计支持后，配置权限时，还需要注意以下几点：
### 1. 确定是否支持前端配置
如果角色和权限相对固定，则一般将角色与权限的关系可以写在后台，改动时需要后端变更且重新上线；这种情况适用于公司内部系统等只有一个使用主体的系统。
如果需要自定义角色、或者每个角色在不同使用者的场景下有不同的权限，则需要将角色的定义、角色与权限之间的配置体现在“前端用户配置页面”；这种情况适用于有频繁变动的自定义角色权限，和有租户体系的系统。

### 2. 以基本单元拆分，以业务逻辑配置
一般可将每个对象的“增、删、改、查”各自作为一个基本的权限单元。打个比方，在“人员管理”中，查看人员列表、添加人员、删除人员、编辑人员信息最好拆分为4个权限单元。在技术和设计上，我们希望能尽量做到解耦和模块化。

但是在业务层面有些操作却是一体的。这些不能拆开的权限在“前端用户配置页面”中建议打包成一个整体提供配置。例如，如果我们确定在系统的现有和未来业务中，仅分为普通成员有“人员管理”的查看权限，管理员有操作权限，则可将“增、删、改”三个基本权限单位合并为“操作”权限进行配置。

### 3. 页面权限优先于操作和数据权限
必须配置了页面模块权限后，才能配置当前页面模块下具体的操作权限，以及页面模块的数据展示权限；

### 4. 查看权限优先于增删改权限
正常情况下，一定要先能查看某个模块或操作，其它的增删改操作才有意义。因此在设计时，应在获取查看权限前限制其它权限的配置；或者配置其它权限时默认赋予查看权限。
### 5. 角色与权限的多种关系
角色与权限的关系不仅是单纯“是/否关系”，还包括以某种限制进行操作，和以某种程度访问数据。例如在“人员管理”中：
- 数据范围：用户拥有查看人员列表的权限，但仅能查看自己所在的团队；
- 数据边界限制（上限等）：添加人员时不能超过20个等。
- 数据字段：HR能查看人员列表中包括职级、薪资等字段；其它角色仅能查看姓名邮箱等字段；

### 6. 角色与权限的设计表达

在传达一个系统的权限设计规则时，设计师常常习惯用主观最直接的方式表达想法，如用“当……时，就……”的句式来表达。但一个平台中涉及的权限规则是非常多的，当通篇以这样的形式描述时，表达对象将很难理解。